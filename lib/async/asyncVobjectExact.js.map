{"version":3,"sources":["../../src/async/asyncVobjectExact.js"],"names":["asyncVobjectExact","AsyncVObjectExactType","schema","validate","AsyncVType","s","oes","v","objectType","o","keys","errors","all","map","key","hasOwnProperty","ValidationError","expected","noProperty","got","length"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAiBgBA,iB,GAAAA,iB;;AAfhB;;AACA;;AACA;;;;IAEaC,qB,WAAAA,qB;;;AAKX,iCAAYC,MAAZ,EAAuBC,QAAvB,EAA+D;AAAA;;AAAA,oKACvD,aADuD,EACxCA,QADwC;;AAE7D,UAAKD,MAAL,GAAcA,MAAd;AAF6D;AAG9D;;;EALOE,uB;;AAQH,SAASJ,iBAAT,CACLK,CADK,EAEqE;AAAA;;AAC1E,MAAMC,MAAM,IAAIL,qBAAJ,CAA0BI,CAA1B;AAAA,wFAA6B,kBAAME,CAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAC7BC,gBAD6B;AAAA;AAAA,qBACHD,CADG;;AAAA;AAAA;AACjCE,eADiC,gBAClBN,QADkB;AAEjCO,kBAFiC,GAE1B,oBAAYD,CAAZ,CAF0B;AAGjCE,oBAHiC,GAGxB,EAHwB;AAAA;AAAA,qBAIjC,kBAAQC,GAAR,CACJF,KAAKG,GAAL;AAAA,qGAAS,iBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA,8BACFT,EAAEU,cAAF,CAAiBD,GAAjB,CADE;AAAA;AAAA;AAAA;;AAELH,iCAAOG,GAAP,IAAc,IAAIE,gCAAJ,CAAoB;AAChCC,sCAAUC,gBADsB;AAEhCC,iCAAKV,EAAEK,GAAF;AAF2B,2BAApB,CAAd;AAFK;AAAA;;AAAA;AAAA;AAAA;AAAA,iCAQGT,EAAES,GAAF,EAAOX,QAAP,CAAgBM,EAAEK,GAAF,CAAhB,CARH;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA,gCAUC,uBAAaE,gCAVd;AAAA;AAAA;AAAA;;AAU+BL,iCAAOG,GAAP;AAV/B;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAT;;AAAA;AAAA;AAAA;AAAA,kBADI,CAJiC;;AAAA;AAAA,mBAoBnC,mCAA2BH,MAA3B,EAAmCS,MApBA;AAAA;AAAA;AAAA;;AAAA,oBAqB/B,IAAIJ,gCAAJ,CAAoB,EAAEC,UAAUX,GAAZ,EAAiBa,KAAKV,CAAtB,EAAyBE,cAAzB,EAApB,CArB+B;;AAAA;AAAA,gDAsB/BF,CAtB+B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA7B;;AAAA;AAAA;AAAA;AAAA,MAAZ;AAwBA,SAAOH,GAAP;AACD","file":"asyncVobjectExact.js","sourcesContent":["// @flow\n\nimport { ValidationError } from \"../sync/ValidationError\";\nimport { AsyncVType } from \"./AsyncVType\";\nimport { objectType, noProperty } from \"../sync/base\";\n\nexport class AsyncVObjectExactType<\n  S: { [key: string]: AsyncVType<any> },\n  T: $ObjMap<S, <F>(v: AsyncVType<F>) => F>\n> extends AsyncVType<T> {\n  schema: S;\n  constructor(schema: S, validate: (value: mixed) => Promise<T>) {\n    super(\"objectExact\", validate);\n    this.schema = schema;\n  }\n}\n\nexport function asyncVobjectExact<S: { [key: string]: AsyncVType<any> }>(\n  s: S\n): AsyncVObjectExactType<S, $Exact<$ObjMap<S, <F>(v: AsyncVType<F>) => F>>> {\n  const oes = new AsyncVObjectExactType(s, async v => {\n    const o = objectType.validate(await v);\n    const keys = Object.keys(o);\n    const errors = {};\n    await Promise.all(\n      keys.map(async key => {\n        if (!s.hasOwnProperty(key)) {\n          errors[key] = new ValidationError({\n            expected: noProperty,\n            got: o[key]\n          });\n        } else\n          try {\n            await s[key].validate(o[key]);\n          } catch (e) {\n            if (e instanceof ValidationError) errors[key] = e;\n            else throw e;\n          }\n      })\n    );\n    if (Object.getOwnPropertyNames(errors).length)\n      throw new ValidationError({ expected: oes, got: o, errors });\n    return (o: any);\n  });\n  return oes;\n}\n"]}